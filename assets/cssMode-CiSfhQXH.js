import{e as p,R as D,l as s,a as k,U as R}from"./CodeEditor.component-B5BAun56.js";import{I as T,C as d,F as w,D as _,a as C,S as l}from"./cssWorker-Ctf9U8Md.js";import"./index-B29v6BxU.js";import"./editorWorker-CA1WEzK_.js";var A=2*60*1e3,M=function(){function e(r){var o=this;this._defaults=r,this._worker=null,this._idleCheckInterval=window.setInterval(function(){return o._checkIfIdle()},30*1e3),this._lastUsedTime=0,this._configChangeListener=this._defaults.onDidChange(function(){return o._stopWorker()})}return e.prototype._stopWorker=function(){this._worker&&(this._worker.dispose(),this._worker=null),this._client=null},e.prototype.dispose=function(){clearInterval(this._idleCheckInterval),this._configChangeListener.dispose(),this._stopWorker()},e.prototype._checkIfIdle=function(){if(this._worker){var r=Date.now()-this._lastUsedTime;r>A&&this._stopWorker()}},e.prototype._getClient=function(){return this._lastUsedTime=Date.now(),this._client||(this._worker=p.createWebWorker({moduleId:"vs/language/css/cssWorker",label:this._defaults.languageId,createData:{options:this._defaults.options,languageId:this._defaults.languageId}}),this._client=this._worker.getProxy()),this._client},e.prototype.getLanguageServiceWorker=function(){for(var r=this,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var n;return this._getClient().then(function(t){n=t}).then(function(t){return r._worker.withSyncedResources(o)}).then(function(t){return n})},e}(),E=function(){function e(r,o,a){var n=this;this._languageId=r,this._worker=o,this._disposables=[],this._listener=Object.create(null);var t=function(u){var f=u.getModeId();if(f===n._languageId){var h;n._listener[u.uri.toString()]=u.onDidChangeContent(function(){window.clearTimeout(h),h=window.setTimeout(function(){return n._doValidate(u.uri,f)},500)}),n._doValidate(u.uri,f)}},i=function(u){p.setModelMarkers(u,n._languageId,[]);var f=u.uri.toString(),h=n._listener[f];h&&(h.dispose(),delete n._listener[f])};this._disposables.push(p.onDidCreateModel(t)),this._disposables.push(p.onWillDisposeModel(i)),this._disposables.push(p.onDidChangeModelLanguage(function(u){i(u.model),t(u.model)})),a.onDidChange(function(u){p.getModels().forEach(function(f){f.getModeId()===n._languageId&&(i(f),t(f))})}),this._disposables.push({dispose:function(){for(var u in n._listener)n._listener[u].dispose()}}),p.getModels().forEach(t)}return e.prototype.dispose=function(){this._disposables.forEach(function(r){return r&&r.dispose()}),this._disposables=[]},e.prototype._doValidate=function(r,o){this._worker(r).then(function(a){return a.doValidation(r.toString())}).then(function(a){var n=a.map(function(i){return P(r,i)}),t=p.getModel(r);t&&t.getModeId()===o&&p.setModelMarkers(t,o,n)}).then(void 0,function(a){console.error(a)})},e}();function F(e){switch(e){case _.Error:return k.Error;case _.Warning:return k.Warning;case _.Information:return k.Info;case _.Hint:return k.Hint;default:return k.Info}}function P(e,r){var o=typeof r.code=="number"?String(r.code):r.code;return{severity:F(r.severity),startLineNumber:r.range.start.line+1,startColumn:r.range.start.character+1,endLineNumber:r.range.end.line+1,endColumn:r.range.end.character+1,message:r.message,code:o,source:r.source}}function m(e){if(e)return{character:e.column-1,line:e.lineNumber-1}}function K(e){if(e)return{start:{line:e.startLineNumber-1,character:e.startColumn-1},end:{line:e.endLineNumber-1,character:e.endColumn-1}}}function g(e){if(e)return new D(e.start.line+1,e.start.character+1,e.end.line+1,e.end.character+1)}function H(e){return typeof e.insert<"u"&&typeof e.replace<"u"}function W(e){var r=s.CompletionItemKind;switch(e){case d.Text:return r.Text;case d.Method:return r.Method;case d.Function:return r.Function;case d.Constructor:return r.Constructor;case d.Field:return r.Field;case d.Variable:return r.Variable;case d.Class:return r.Class;case d.Interface:return r.Interface;case d.Module:return r.Module;case d.Property:return r.Property;case d.Unit:return r.Unit;case d.Value:return r.Value;case d.Enum:return r.Enum;case d.Keyword:return r.Keyword;case d.Snippet:return r.Snippet;case d.Color:return r.Color;case d.File:return r.File;case d.Reference:return r.Reference}return r.Property}function S(e){if(e)return{range:g(e.range),text:e.newText}}function L(e){return e&&e.command==="editor.action.triggerSuggest"?{id:e.command,title:e.title,arguments:e.arguments}:void 0}var N=function(){function e(r){this._worker=r}return Object.defineProperty(e.prototype,"triggerCharacters",{get:function(){return[" ",":"]},enumerable:!1,configurable:!0}),e.prototype.provideCompletionItems=function(r,o,a,n){var t=r.uri;return this._worker(t).then(function(i){return i.doComplete(t.toString(),m(o))}).then(function(i){if(i){var u=r.getWordUntilPosition(o),f=new D(o.lineNumber,u.startColumn,o.lineNumber,u.endColumn),h=i.items.map(function(c){var v={label:c.label,insertText:c.insertText||c.label,sortText:c.sortText,filterText:c.filterText,documentation:c.documentation,detail:c.detail,command:L(c.command),range:f,kind:W(c.kind)};return c.textEdit&&(H(c.textEdit)?v.range={insert:g(c.textEdit.insert),replace:g(c.textEdit.replace)}:v.range=g(c.textEdit.range),v.insertText=c.textEdit.newText),c.additionalTextEdits&&(v.additionalTextEdits=c.additionalTextEdits.map(S)),c.insertTextFormat===T.Snippet&&(v.insertTextRules=s.CompletionItemInsertTextRule.InsertAsSnippet),v});return{isIncomplete:i.isIncomplete,suggestions:h}}})},e}();function V(e){return e&&typeof e=="object"&&typeof e.kind=="string"}function I(e){return typeof e=="string"?{value:e}:V(e)?e.kind==="plaintext"?{value:e.value.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}:{value:e.value}:{value:"```"+e.language+`
`+e.value+"\n```\n"}}function U(e){if(e)return Array.isArray(e)?e.map(I):[I(e)]}var O=function(){function e(r){this._worker=r}return e.prototype.provideHover=function(r,o,a){var n=r.uri;return this._worker(n).then(function(t){return t.doHover(n.toString(),m(o))}).then(function(t){if(t)return{range:g(t.range),contents:U(t.contents)}})},e}();function j(e){switch(e){case C.Read:return s.DocumentHighlightKind.Read;case C.Write:return s.DocumentHighlightKind.Write;case C.Text:return s.DocumentHighlightKind.Text}return s.DocumentHighlightKind.Text}var B=function(){function e(r){this._worker=r}return e.prototype.provideDocumentHighlights=function(r,o,a){var n=r.uri;return this._worker(n).then(function(t){return t.findDocumentHighlights(n.toString(),m(o))}).then(function(t){if(t)return t.map(function(i){return{range:g(i.range),kind:j(i.kind)}})})},e}();function x(e){return{uri:R.parse(e.uri),range:g(e.range)}}var $=function(){function e(r){this._worker=r}return e.prototype.provideDefinition=function(r,o,a){var n=r.uri;return this._worker(n).then(function(t){return t.findDefinition(n.toString(),m(o))}).then(function(t){if(t)return[x(t)]})},e}(),q=function(){function e(r){this._worker=r}return e.prototype.provideReferences=function(r,o,a,n){var t=r.uri;return this._worker(t).then(function(i){return i.findReferences(t.toString(),m(o))}).then(function(i){if(i)return i.map(x)})},e}();function z(e){if(!(!e||!e.changes)){var r=[];for(var o in e.changes)for(var a=R.parse(o),n=0,t=e.changes[o];n<t.length;n++){var i=t[n];r.push({resource:a,edit:{range:g(i.range),text:i.newText}})}return{edits:r}}}var G=function(){function e(r){this._worker=r}return e.prototype.provideRenameEdits=function(r,o,a,n){var t=r.uri;return this._worker(t).then(function(i){return i.doRename(t.toString(),m(o),a)}).then(function(i){return z(i)})},e}();function J(e){var r=s.SymbolKind;switch(e){case l.File:return r.Array;case l.Module:return r.Module;case l.Namespace:return r.Namespace;case l.Package:return r.Package;case l.Class:return r.Class;case l.Method:return r.Method;case l.Property:return r.Property;case l.Field:return r.Field;case l.Constructor:return r.Constructor;case l.Enum:return r.Enum;case l.Interface:return r.Interface;case l.Function:return r.Function;case l.Variable:return r.Variable;case l.Constant:return r.Constant;case l.String:return r.String;case l.Number:return r.Number;case l.Boolean:return r.Boolean;case l.Array:return r.Array}return r.Function}var Q=function(){function e(r){this._worker=r}return e.prototype.provideDocumentSymbols=function(r,o){var a=r.uri;return this._worker(a).then(function(n){return n.findDocumentSymbols(a.toString())}).then(function(n){if(n)return n.map(function(t){return{name:t.name,detail:"",containerName:t.containerName,kind:J(t.kind),tags:[],range:g(t.location.range),selectionRange:g(t.location.range)}})})},e}(),X=function(){function e(r){this._worker=r}return e.prototype.provideDocumentColors=function(r,o){var a=r.uri;return this._worker(a).then(function(n){return n.findDocumentColors(a.toString())}).then(function(n){if(n)return n.map(function(t){return{color:t.color,range:g(t.range)}})})},e.prototype.provideColorPresentations=function(r,o,a){var n=r.uri;return this._worker(n).then(function(t){return t.getColorPresentations(n.toString(),o.color,K(o.range))}).then(function(t){if(t)return t.map(function(i){var u={label:i.label};return i.textEdit&&(u.textEdit=S(i.textEdit)),i.additionalTextEdits&&(u.additionalTextEdits=i.additionalTextEdits.map(S)),u})})},e}(),Y=function(){function e(r){this._worker=r}return e.prototype.provideFoldingRanges=function(r,o,a){var n=r.uri;return this._worker(n).then(function(t){return t.getFoldingRanges(n.toString(),o)}).then(function(t){if(t)return t.map(function(i){var u={start:i.startLine+1,end:i.endLine+1};return typeof i.kind<"u"&&(u.kind=Z(i.kind)),u})})},e}();function Z(e){switch(e){case w.Comment:return s.FoldingRangeKind.Comment;case w.Imports:return s.FoldingRangeKind.Imports;case w.Region:return s.FoldingRangeKind.Region}}var ee=function(){function e(r){this._worker=r}return e.prototype.provideSelectionRanges=function(r,o,a){var n=r.uri;return this._worker(n).then(function(t){return t.getSelectionRanges(n.toString(),o.map(m))}).then(function(t){if(t)return t.map(function(i){for(var u=[];i;)u.push({range:g(i.range)}),i=i.parent;return u})})},e}();function oe(e){var r=[],o=[],a=new M(e);r.push(a);var n=function(){for(var i=[],u=0;u<arguments.length;u++)i[u]=arguments[u];return a.getLanguageServiceWorker.apply(a,i)};function t(){var i=e.languageId,u=e.modeConfiguration;y(o),u.completionItems&&o.push(s.registerCompletionItemProvider(i,new N(n))),u.hovers&&o.push(s.registerHoverProvider(i,new O(n))),u.documentHighlights&&o.push(s.registerDocumentHighlightProvider(i,new B(n))),u.definitions&&o.push(s.registerDefinitionProvider(i,new $(n))),u.references&&o.push(s.registerReferenceProvider(i,new q(n))),u.documentSymbols&&o.push(s.registerDocumentSymbolProvider(i,new Q(n))),u.rename&&o.push(s.registerRenameProvider(i,new G(n))),u.colors&&o.push(s.registerColorProvider(i,new X(n))),u.foldingRanges&&o.push(s.registerFoldingRangeProvider(i,new Y(n))),u.diagnostics&&o.push(new E(i,n,e)),u.selectionRanges&&o.push(s.registerSelectionRangeProvider(i,new ee(n)))}return t(),r.push(b(o)),b(r)}function b(e){return{dispose:function(){return y(e)}}}function y(e){for(;e.length;)e.pop().dispose()}export{oe as setupMode};
